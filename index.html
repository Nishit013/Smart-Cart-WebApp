<!DOCTYPE html>
<html>
<head>
<title>üõí Smart Cart Pro</title>
<style>
   body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #eef2f3, #8e9eab);
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      color: #222;
    }
    .btn {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    #output {
      margin-top: 15px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      min-height: 80px;
    }
    #cart {
      margin-top: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 15px;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .remove-btn, .edit-btn {
      background: red;
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      color: white;
      cursor: pointer;
    }
    .edit-btn {
      background: orange;
      margin-left: 5px;
    }
    .remove-btn:hover {
      background: darkred;
    }
    .edit-btn:hover {
      background: darkorange;
    }
    input[type="tel"] {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
      width: 200px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #payment-placeholder {
      margin-top: 20px;
      padding: 10px;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      border-radius: 5px;
      color: #856404;
    }
</style>
 
  <!-- ‚úÖ Razorpay Script for Payment -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
 
  <h1> Smart Cart Pro Web App</h1>
<button class="btn" onclick="connectToCart()">üîó Connect to Cart</button>
<button class="btn" onclick="clearCart()">‚ôªÔ∏è Clear Cart</button>
 
  <div id="output">Not connected.</div>
<div id="cart"></div>
<input type="tel" id="customerPhone" placeholder="Enter WhatsApp Number" />
<div id="payment-placeholder">
    üí≥ <strong>Payment Gateway:</strong> Razorpay integrated 
</div>
 
  <script>
    let bleCharacteristic;
    let cartItems = [];
 
    const productDB = {
      "8901234567890": { name: "Coke 500ml", price: 40 },
      "9876543210123": { name: "Chips Large", price: 50 },
      "1234567890128": { name: "Bread Loaf", price: 30 },
      "8801234567895": { name: "Maggie Noodles", price: 12 },
      "8901058856745": { name: "Dettol Soap", price: 28 }
    };
 
    async function connectToCart() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ name: 'ESP32-Scanner' }],
          optionalServices: ['0000ffe0-0000-1000-8000-00805f9b34fb']
        });
 
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb');
        bleCharacteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');
 
        await bleCharacteristic.startNotifications();
        bleCharacteristic.addEventListener('characteristicvaluechanged', handleData);
 
        document.getElementById("output").textContent = "‚úÖ Connected to Smart Cart. Scan a product...";
      } catch (error) {
        document.getElementById("output").textContent = `‚ùå Connection failed: ${error}`;
      }
    }
 
    function handleData(event) {
      const barcode = new TextDecoder().decode(event.target.value).trim();
      const output = document.getElementById("output");
      const product = productDB[barcode];
 
      if (product) {
        cartItems.push({...product});
        output.textContent += `\nüì¶ Scanned: ${product.name} - ‚Çπ${product.price}`;
        renderCart();
      } else {
        output.textContent += `\n‚ùì Unknown barcode: ${barcode}`;
      }
    }
 
    function renderCart() {
      const cartDiv = document.getElementById("cart");
      let html = '<h2>üìø Cart Summary</h2><ul>';
      let total = 0;
 
      cartItems.forEach((item, index) => {
        total += item.price;
        html += `
<li>
<span>${item.name} - ‚Çπ${item.price}</span>
<span>
<button class="edit-btn" onclick="editItem(${index})">Edit</button>
<button class="remove-btn" onclick="removeItem(${index})">Remove</button>
</span>
</li>`;
      });
 
      html += `</ul><h3>Total: ‚Çπ${total}</h3>`;
      html += `<button class="btn" onclick="checkout()">üí≥ Checkout & Generate Bill</button>`;
      cartDiv.innerHTML = html;
    }
 
    function editItem(index) {
      const newName = prompt("Edit product name:", cartItems[index].name);
      const newPrice = parseFloat(prompt("Edit product price:", cartItems[index].price));
      if (newName && !isNaN(newPrice)) {
        cartItems[index].name = newName;
        cartItems[index].price = newPrice;
        renderCart();
      }
    }
 
    function removeItem(index) {
      cartItems.splice(index, 1);
      renderCart();
    }
 
    function clearCart() {
      cartItems = [];
      document.getElementById("output").textContent = "üßπ Cart cleared.";
      renderCart();
    }
 
    function sendWhatsAppBill(summary) {
      const number = document.getElementById("customerPhone").value.trim();
      if (number) {
        const encodedMessage = encodeURIComponent(summary);
        const whatsappURL = `https://wa.me/${number}?text=${encodedMessage}`;
        window.open(whatsappURL, '_blank');
      }
    }
 
    function checkout() {
      let summary = 'üìø Bill Receipt\n\n';
      let total = 0;
 
      cartItems.forEach((item, i) => {
        summary += `${i + 1}. ${item.name} - ‚Çπ${item.price}\n`;
        total += item.price;
      });
 
      summary += `\nTotal: ‚Çπ${total}`;
      const totalAmount = total * 100; // Razorpay in paise
 
      const options = {
        key: "rzp_test_YourKeyHere", // üîÅ Replace with your Razorpay test key
        amount: totalAmount,
        currency: "INR",
        name: "Smart Cart Pro",
        description: "Smart Cart Payment",
        handler: function (response) {
          alert("üí≥ Payment Successful: " + response.razorpay_payment_id);
          sendWhatsAppBill(summary);
          clearCart();
        },
        prefill: {
          name: "Smart Customer",
          contact: "",
        },
        theme: {
          color: "#007bff",
        },
      };
 
      const rzp1 = new Razorpay(options);
      rzp1.open();
    }
</script>
</body>
</html>